# 复合类型

## 数组

数组(array)是一种数据格式，能够存储多个同类型的值。每个值都存储在一个独立的数组元素中，计算机在内存中依次存储数组的各个元素。
要创建数组，可使用声明语句。数组声明应指出一下三点：

- 存储在每个元素中的值的类型
- 数组名
- 数组中的元素数
  在 C++中，可以通过修改简单变量的声明，添加中括号(其中包含元素数组)来完成数组声明。
  声明数组的通用格式如下：
  `typename arrayname[arraySize]`;

表达式`arraySize`指定元素数目，它必须是整形常数或 const 值，也可以是常量表达式(如 8\*sizeof(int))，即其中所有的值在编译时都是一致的。具体地说，arraySize 不能是变量，变量的值是在程序运行时设置的。然而，我们可以用 new 运算符进行规避。
数组之所以被称为复合类型，是因为他是使用其他类型来创建的。不能仅仅将某种东西声明维数组，它必须是特定类型的数组。没有通用的数组类型，但存在很多特定的数组类型。
数组的和多用途都是基于这样一个事实：可以单独访问数组元素。方法是使用下标或索引来对元素进行编号。C++数组从 0 开始编号。C++使用带索引的方括号表示法来指定数组元素。因此，数组元素声明能够使用一个声明创建大量的变量，然后便可以用索引来标识和访问各个元素。
注意：
编译器不会检查使用的下表是否有效。

### 数组的初始化规则

只有定义数组时才能使用初始化，此后就不能使用了，也不能将一个数组赋给另一个数组。然而，可以使用下标分别给数组中的元素赋值。
初始化数组时，提供的值可以少于数组的元素数目。如果只对数组的一部分进行初始化，则编译器将把其他元素设置为 0.因此，将数组中所有的数组都初始化为 0 非常简单——只要显式地将第一个元素初始化为 0，然后让编译器将其他元素都初始化为 0 即可。
如果初始化数组时方括号内为空，C++编译器将计算元素个数。

## 字符串

字符串是存储在内存的连续字节中的一系列字符。C++处理字符串的方式有两种。第一种来自 C 语言，常被称为 C-风格字符串(C-style string)。本章将首先介绍他，然后介绍另一种基于 string 类库的方法。我们首先介绍它。
存储在连续字节中的一些列字符意味着可以将字符串存储在`char`数组中，其中每个字符都位于自己的数组元素中。字符串提供了一种存储文本信息的便捷方式。C-字符串具有一种特殊的性质：以空字符(null character)结尾，空字符被写作`\0`，其中 ASCII 码为 0，用来标记字符串的结尾。
将字符数组初始化为字符串，更好的方法是使用引号括起字符串即可，这种字符串被称为字符串常量，这种字符串被称为字符串常量或字符串字面值。
用引号括起的字符串隐式地包括结尾的空字符，因此不用显式地包括他。

### 拼接字符串常量

有时候，字符串很长无法放到一行中。C++允许拼接字符串字面值，即将两个用引号阔气的字符串合并成为一个。事实上，任何两个有空白(空格、制表符和换行符)分隔的字符串常量都将自动拼接成一个。
注意，拼接式，不会再被连接的字符串之间添加空格，第一个字符串中的`\0`将被第二个字符串的第一个字符取代。

### 在数组中使用字符串

要将字符串存储到数组中，最常用的方法有两种——将数组初始化为字符串常量、将键盘或文件输入读入到数组中。
我们可以使用`sizeof`来计算整个数组的长度，以及使用`strlen()`来计算存储在数组中的字符串的长度。

```Cpp
#include<iostream>
using namespace std;
int main() {
	char str[20] = "Hello world";
	cout << sizeof(str) << " " << strlen(str) << endl;
}
```

### 字符串输入

`cin`是如何确定已完成字符串输入呢？由于不能通过通过键盘输入空字符，因此`cin`需要用别的方法来确定字符串的结尾位置。`cin`使用空白来确定字符串的结束位置，这意味着`cin`在获取字符数组输入时只读取一个单词。读取该单词后，`cin`将该字符串放到数组中，并自动在结尾添加空字符串。

#### 每次读取一行字符串输入

1. getline()
   `getline`函数读取整行，它使用通过回车键输入的换行符老确定输入结尾。要调用这种方法，可以使用`cin.getline()`。该函数有两个参数，第一个参数是用来存储输入行的数组的名称，第二个参数是要读取的字符数。如果参数为 20，则函数最多读取 19 个字符，余下的空间用于存储自动在结尾处添加的空字符。`getline()`成员函数在读取指定数目的字符或遇到换行符时停止读取。同时，该函数不会存储换行符，在存储字符串时，他讲使用空字符来替换换行符。

2. get()
   istream 类还有另一个名为`get()`的成员函数，该函数有几种变体。其中一种变体的工作方式与`getline()`相似，他们接受的参数相同，解释参数的方式也相同，并且都读取到行尾。但`get`并不在读取并丢弃换行符，而是将其留在输入队列中。

```Cpp
#include<iostream>
using namespace std;
int main() {
	const int Size = 20;
	char str[Size];
	char str2[Size];
	cin.get(str, 20);
	cin.get(str2, 20);
	cout << str << str2<< endl;
}
```

在该程序中，由于第一次调用将换行符留在输入队列中，因此第二次调用时看到的第一个字符辨识换行符。因此`get()`认为已到达行尾，而没有发现， 任何可读取的内容。幸运的是，`get()`有另一种变体。使用不带任何参数的`cin.get()`调用课读取下一个字符(即使是换行符),因此可以用它来处理换行符，为读取下一行输入做好准备。

```CPP
#include<iostream>
using namespace std;
int main() {
	const int Size = 20;
	char str[Size];
	char str2[Size];
	cin.get(str, 20);
	cin.get();
	cin.get(str2, 20);
	cout << str << str2<< endl;
}
```

另一种使用`get()`的方式是将两个类成员函数拼接起来(合并)，如下所示:
`cin.get(name, ArSize).get()`

```Cpp
#include<iostream>
using namespace std;
int main() {
	char str1[20];
	char str2[20];
	cin.get(str1, 20).get();
	cin.get(str2, 20).get();
	cout << str1 << endl << str2 << endl;
}
```

之所可以这样做，是由于`cin.get(name, Arsize)`返回一个 cin 对象，该对象随后将被用来调用`get()`函数。同样，下面的语句将把输入连续的两行分别读入到输入`name1`和`name2`，其效果与两次调用`cin.getline()`相同。
`cin.getlin(name1, Arsize).geliine(name2, Arsize)`
需要指出的一点是，C++允许函数有多个版本，条件是这些版本的参数列表不同。

### 空行和其他问题

当`getline()`或`get()`读取空行是，将会发生什么情况？最初的做法是，下一条输入语句将在前一条`getline()`或`get()`结束读取的位置开始读取；但当前的做法是，当 `get()`(不是`getline()`)读取空行后将设置失效位(failbit)。这意味着接下来的输入将被阻断，但可以用下面的命令来恢复输入。
`cin.clear()`
`cin.sync()`
`cin.ignore()`

```Cpp
#include<iostream>
using namespace std;
int main() {
	char str1[20];
	char str2[20];
	int num;
	cin.get(str1, 20);
	cin.clear();
	//cin.sync();
	//cin >> num;
	//cin.get();
	cin.ignore();
	cin.get(str2, 20);
	cout << str1 << endl << str2 << endl;
}
```

这两句代码很重要，cin.clear()主要将 cin 的状态清 0，让我们可以继续输入，cin.sync()让流与其对应的数据源同步，这样流就可以丢弃掉之前没有处理的数据，如果不这样做，前面的没有处理掉的数据如果不能转换为需要的类型，那么流会一直处于错误状态。
cin.ignore():它的一个常用功能就是用来清除以回车结束的输入缓冲区的内容，消除上一次输入对下一次输入的影响。比如可以这么用：cin.ignore(1024,’\n’)，通常把第一个参数设置得足够大，这样实际上总是只有第二个参数’\n’起作用，所以这一句就是把回车（包括回车）之前的所以字符从输入缓冲（流）中清除出去。在 cin.get()和 getchar()中也提到了它的用法。
另一个潜在的问题是，输入字符串可能比分配的空间长。如果输入行包含的字符数比指定的多，则`getline()`和`get`将把余下的字符留在输入独立俄中，而`getline()`还会设置失效位，将关闭后面的输入。

### 混合输入字符串和数字

当输入数字后，换行符会留在输入队列中。后面的输入函数看到换行符后将认为是一个空行，并将一个空字符串赋给字符串数组。
C++程序长使用指针(而不是数组)来处理字符串。

## string 类简介

在 IOS/ANSI C++ 98 中添加`string`类扩展了 C++库，因此现在可以使用 string 类型的变量而不是字符数组存储字符串。
要使用`string`必须在程序中包含头文件`string`。`string`类位于名称空间 std 中。`string`类定义隐藏了字符串的数组性质，能够像处理普通变量那样处理字符串。
在很多方面，使用`string`对象的方式与使用字符数组相同。

- 可以使用 C-风格字符串来初始化 string 对象。
- 可以使用 cin 来将键盘输入存储到 string 对象中。
- 可以使用 cout 来显示 string 对象。
- 可以使用数组表示法来访问存储在 string 对象中的字符。

string 对象和字符数组之间的主要区别是，可以将 string 对象声明为简单变量，而不是数组；
类设计让程序能够自动处理 string 的大小。这使得与使用数组相比，使用 string 对象更方便也更安全。从理论上说，可以将 char 数组视为一组用于存储一个字符串的`char`存储单元，而`string`类变量是一个表示字符串的实体。

### C++11 字符串初始化

`string str = "hello world"`

### 赋值、拼接和附加

使用 string 类时，某些操作比使用数组时更简单。例如：不能将一个数组赋值给另一个数组，但可以将一个 string 对象赋给另一个 string 对象。

```cpp
string str1 = "Hello world"
string str2 = str1;
```

同时，string 类简化了字符串合并操作。可以使用运算符+将两个 string 对象合并起来，还可以使用运算符+=将字符串附加到 string 对象的末尾。

```cpp
#include<iostream>
using namespace std;
int main() {
	string str1 = "Hello world";
	string str2 = "I Love CPP";
	cout << str1 + str2 << endl;
}
```

### string 类的其他操作

我们还可以使用 C 语言库中的函数来完成这些任务。头文件 cstring(以前为 string.h)提供了这些函数。例如，可以使用函数 strcpy()将字符串复制到字符数组中，使用函数 strcat()将字符串附加到字符数组末尾。

```Cpp
strcpy(charr1, charr2);
strcat(charr1, charr2);
```

函数 strlen()是一个常规函数，他接受一个 C-风格字符串作为参数，并返回该字符串包含的字符数。函数 size()的功能基本上与此相同。

### string 类 I/O

可以使用 cin 和运算符>>来将输入存储到 string 对象中，使用 cout 和运算符<<来显式 string 对象，其语法处理与 C-风格字符串相同。但每次读取一行而不是一个单词时，使用的句法不同。

```Cpp
#include<iostream>
#include<cstring>
#include<string>
using namespace std;
int main() {
	string str, str2;
	cin >> str;
	cout << str << endl;
	cin.get();
	getline(cin, str2);
	cout << str2 << endl;
}
```
